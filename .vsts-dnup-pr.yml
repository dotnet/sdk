# Pipeline: https://dev.azure.com/dnceng-public/public/_build?definitionId=323

trigger: none

pr:
  branches:
    include:
    - dnup
  paths:
    include:
    - src/Installer/dnup/
    - test/dnup.Tests/
    - global.json
    - .vsts-dnup-tests.yml

parameters:
- name: enableArm64Job
  displayName: Enables the ARM64 job
  type: boolean
  default: true

variables:
- template: /eng/pipelines/templates/variables/sdk-defaults.yml
  # Variables used: DncEngPublicBuildPool
- template: /eng/common/templates/variables/pool-providers.yml

stages:
- stage: dnup
  displayName: ðŸ”Ž dnup tests
  jobs:
  ############### WINDOWS ###############
  - template: /eng/pipelines/templates/jobs/dnup-tests.yml@self
    parameters:
      pool:
        name: $(DncEngPublicBuildPool)
        demands: ImageOverride -equals windows.vs2022.amd64.open
        os: windows
      helixTargetQueue: windows.amd64.vs2022.pre.open

  ############### LINUX ###############
  - template: /eng/pipelines/templates/jobs/dnup-tests.yml@self
    parameters:
      pool:
        name: $(DncEngPublicBuildPool)
        demands: ImageOverride -equals build.ubuntu.2204.amd64.open
        os: linux
      helixTargetQueue: ubuntu.2204.amd64.open

  ############### MACOS ###############
  - template: /eng/pipelines/templates/jobs/dnup-tests.yml@self
    parameters:
      pool:
        name: Azure Pipelines
        vmImage: macOS-latest
        os: macOS
      helixTargetQueue: osx.15.amd64.open

  ### ARM64 ###
  - ${{ if eq(parameters.enableArm64Job, true) }}:
  - template: /eng/pipelines/templates/jobs/dnup-tests.yml@self
    parameters:
      pool:
        name: Azure Pipelines
        vmImage: macOS-latest
        os: macOS
      helixTargetQueue: osx.13.arm64.open


