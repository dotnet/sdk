parameters:
- name: dotNetBuildPass
  type: string
  default: final

- name: verticals
  type: object
  default: []

- name: outputFolder
  type: string
  default: $(Build.ArtifactStagingDirectory)/artifacts

steps:
- powershell: eng/join-verticals.ps1
    /p:VerticalManifestsPath=$(Build.ArtifactStagingDirectory)/VerticalManifests
    /p:DotNetBuildPass=${{ parameters.dotNetBuildPass }}
    /p:VerticalArtifactsBaseFolder=$(Build.ArtifactStagingDirectory)/VerticalArtifacts
    /p:OutputFolder=${{ parameters.outputFolder }}
  displayName: Join Verticals
- task: CopyFiles@2
  displayName: Copy logs for upload
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)/artifacts/log'
    Contents: |
      **/*.log
      **/*.binlog
    TargetFolder: '$(Build.ArtifactStagingDirectory)/artifacts/log'
    CleanTargetFolder: true
