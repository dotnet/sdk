<?xml version="1.0"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory),Build.cmd))\tools\Setup.settings.props" Condition="'$(ToolsPath)'==''" />
  <Import Project="$(BuildNumberProps)" Condition="EXISTS('$(BuildNumberProps)')" />
  <Import Project="$(ToolsPath)\Wix.targets" />

  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">x86</Platform>
    <Lang>enu</Lang>
    <ProductFamily>netfx</ProductFamily>
    <ProductGroupsToBuild>FX</ProductGroupsToBuild>
    <UpgradeCode>C7BB0B7A-67B4-4B3D-8177-7E67DE5CF77F</UpgradeCode>
    <SchemaVersion>2.0</SchemaVersion>
    <OutputName>netfx_NETCoreUWP</OutputName>
    <OutputType>package</OutputType>
    <NuGetPath>$(ToolsPath)\NuGet.exe</NuGetPath>
    <PackageCacheDirectory>https://www.nuget.org/api/v2</PackageCacheDirectory>
    <FrameworkSourceDir>$(MSBuildProjectDirectory)\Source</FrameworkSourceDir>
    <AdditionalSourceDir>$(MSBuildProjectDirectory)\Additional</AdditionalSourceDir>
  </PropertyGroup>
  <PropertyGroup>
    <PackageRestoreDir>$(IntermediateOutputPath)packages</PackageRestoreDir>
    <DefineConstants>
      $(DefineConstants);
      UpgradeCode=$(UpgradeCode);
      PackageRestoreDir=$(PackageRestoreDir);
      PackageCacheDirectory = $(PackageCacheDirectory);
      FrameworkSourceDir=$(FrameworkSourceDir);
      AdditionalSourceDir=$(AdditionalSourceDir);
    </DefineConstants>
  </PropertyGroup>
  <ItemGroup>
    <HarvestDirectory Include="$(PackageRestoreDir)">
      <DirectoryRefId>NuGetPackages</DirectoryRefId>
      <ComponentGroupName>CG_NETCoreUWP</ComponentGroupName>
      <PreprocessorVariable>var.PackageRestoreDir</PreprocessorVariable>
      <SuppressCom>true</SuppressCom>
      <SuppressRegistry>true</SuppressRegistry>
      <SuppressRootDirectory>true</SuppressRootDirectory>
      <Transforms>IlcComponents.xslt</Transforms>
    </HarvestDirectory>
    <HarvestDirectory Include="$(FrameworkSourceDir)">
      <DirectoryRefId>RefAssmsMsFxNetCore5</DirectoryRefId>
      <ComponentGroupName>CG_NETCoreFramework</ComponentGroupName>
      <PreprocessorVariable>var.FrameworkSourceDir</PreprocessorVariable>
      <SuppressCom>true</SuppressCom>
      <SuppressRegistry>true</SuppressRegistry>
      <SuppressRootDirectory>true</SuppressRootDirectory>
    </HarvestDirectory>
  </ItemGroup>

  <!-- Product-related content and user extension point -->
  <ItemGroup>
    <Compile Include="Product.wxs" />
    <Compile Include="Content.wxs" />
    <Compile Include="Provider.wxs" />
  </ItemGroup>
  <ItemGroup>
    <WixExtension Include="WixDependencyExtension">
      <HintPath>$(WixExtDir)\WixDependencyExtension.dll</HintPath>
      <Name>WixDependencyExtension</Name>
    </WixExtension>
    <WixExtension Include="WixNetFxExtension">
      <HintPath>$(WixExtDir)\WixNetFxExtension.dll</HintPath>
      <Name>WixNetFxExtension</Name>
    </WixExtension>
    <WixExtension Include="WixUtilExtension">
      <HintPath>$(WixExtDir)\WixUtilExtension.dll</HintPath>
      <Name>WixUtilExtension</Name>
    </WixExtension>
    <WixExtension Include="WixUIExtension">
      <HintPath>$(WixExtDir)\WixUIExtension.dll</HintPath>
      <Name>WixUIExtension</Name>
    </WixExtension>
  </ItemGroup>

  <Target Name="RestoreProjects"  BeforeTargets="PrepareForBuild">

    <!-- clean up the directory -->
    <RemoveDir Condition="Exists('$(PackageRestoreDir)')" Directories="$(PackageRestoreDir)" />
    <MakeDir Directories="$(PackageRestoreDir)" />

    <!-- "nuget restore" the metapackage into PackageRestoreDir -->
    <Exec Command="$(NuGetPath) restore &quot;$(FrameworkSourceDir)\project.json&quot; -NoCache -Source &quot;$(PackageCacheDirectory)&quot; -PackagesDirectory &quot;$(PackageRestoreDir)&quot;" />

    <!-- "nuget restore" the metapackage (beta)  into PackageRestoreDir -->
    <Exec Command="$(NuGetPath) restore &quot;$(AdditionalSourceDir)\Beta\project.json&quot; -NoCache -Source &quot;$(BetaPackageCacheDirectory)&quot; -PackagesDirectory &quot;$(PackageRestoreDir)&quot;" />

    <!-- get a list of the packages that were restored -->
    <ItemGroup>
      <RestoredPackage Include="$(PackageRestoreDir)\**\*.nupkg" />
    </ItemGroup>
    <Message Text="Number of packages restored is '@(RestoredPackage->Count())'" />
    <Message Text="Restored package '%(RestoredPackage.Identity)'" />
  </Target>

  <ItemGroup>
    <ProjectReference Include="$(SrcPath)\NuGetPackageRegistration\NuGetPackageRegistration-15\NuGetPackageRegistration-15.wixproj">
    </ProjectReference>
  </ItemGroup>
  <Import Project="$(WixTargetsPath)" />
</Project>