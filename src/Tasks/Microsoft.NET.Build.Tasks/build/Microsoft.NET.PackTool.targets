<!--
***********************************************************************************************
Microsoft.NET.PackTool.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) .NET Foundation. All rights reserved.
***********************************************************************************************
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask TaskName="Microsoft.NET.Build.Tasks.GenerateToolsSettingsFile"
              AssemblyFile="$(MicrosoftNETBuildTasksAssembly)" />

  <Target Name="PackTool" DependsOnTargets="GenerateToolsSettingsFileFromBuildProperty;Publish" Condition=" '$(PackAsTool)' == 'true' ">
    <!--All published file in different tools/tfm-->

    <ItemGroup>
        <_PublishedTfmSpecificPackageFiles Include="@(ResolvedFileToPublish->'$(PublishDir)%(RelativePath)')"/>
        <_PublishedTfmSpecificPackageFiles Include="$(PublishDepsFilePath)"/>
        <_PublishedTfmSpecificPackageFiles Include="$(PublishRuntimeConfigFilePath)"/>
    </ItemGroup>

    <ItemGroup>
      <TfmSpecificPackageFile Include="@(_PublishedTfmSpecificPackageFiles)">
        <PackagePath>tools/$(targetframework)/any/%(_PublishedTfmSpecificPackageFiles.RecursiveDir)%(_PublishedTfmSpecificPackageFiles.Filename)%(_PublishedTfmSpecificPackageFiles.Extension)</PackagePath>
      </TfmSpecificPackageFile>
    </ItemGroup>

    <ItemGroup>
       <PackageReference Remove="@(PackageReference)"/>
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <ToolCommandName Condition=" '$(ToolCommandName)' == '' ">$(TargetName)</ToolCommandName>
    <ToolEntryPoint Condition=" '$(ToolEntryPoint)' == '' ">$(TargetFileName)</ToolEntryPoint>
  </PropertyGroup>

  <Target Name="GenerateToolsSettingsFileFromBuildProperty" >
    <GenerateToolsSettingsFile
       EntryPointRelativePath="$(ToolEntryPoint)"
       CommandName="$(ToolCommandName)"
       ToolsSettingsFilePath="$(_ToolsSettingsFilePath)" />
  </Target>

</Project>
