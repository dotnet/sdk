<!--
***********************************************************************************************
Microsoft.NET.GenerateResxCodeBehind.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) .NET Foundation. All rights reserved. 
***********************************************************************************************
-->
<Project>
  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>
  
  <UsingTask TaskName="Microsoft.NET.Build.Tasks.GenerateResxCodeBehindFile" AssemblyFile="$(MicrosoftNETBuildTasksAssembly)" />

  <ItemGroup>
    <EmbeddedResource Update="@(EmbeddedResource)">
      <Generator Condition="'%(EmbeddedResource.GenerateSource)' == 'true'">MSBuild:_GenerateResxSource</Generator>
      <Namespace Condition="'%(EmbeddedResource.Namespace)' == ''">$(RootNamespace)</Namespace>
      <DocCommentMode Condition="'%(EmbeddedResource.DocCommentMode)' == ''">Content</DocCommentMode>
    </EmbeddedResource>
  </ItemGroup>

  <Target Name="_GenerateResxSource" BeforeTargets="CoreCompile"
          DependsOnTargets="PrepareResourceNames;_GetEmbeddedResourcesWithSourceGeneration;_BatchGenerateResxSource">
    <ItemGroup>
      <GeneratedResxSource Include="@(EmbeddedResourceSG -> '%(SourceOutputPath)')" />
      <FileWrites Include="@(GeneratedResxSource)" />
      <Compile Include="@(GeneratedResxSource)" />
    </ItemGroup>
  </Target>

  <Target Name="_CustomizeResourceNames" BeforeTargets="PrepareResourceNames">
    <ItemGroup>
      <EmbeddedResource Update="@(EmbeddedResource)">
        <ManifestResourceName Condition="'%(EmbeddedResource.Namespace)' != ''">%(EmbeddedResource.Namespace).%(EmbeddedResource.FileName)</ManifestResourceName>
      </EmbeddedResource>
    </ItemGroup>
  </Target>

  <Target Name="_BatchGenerateResxSource" Inputs="@(EmbeddedResourceSG)" Outputs="%(EmbeddedResourceSG.SourceOutputPath)">
    <GenerateResxSource Language="$(Language)" ResourceFile="%(EmbeddedResourceSG.FullPath)" ResourceName="%(EmbeddedResourceSG.ManifestResourceName)"
                        OutputPath="%(EmbeddedResourceSG.SourceOutputPath)" DocCommentMode="%(EmbeddedResourceSG.DocCommentMode)" />
  </Target>

  <Target Name="_GetEmbeddedResourcesWithSourceGeneration">
    <PropertyGroup>
      <_EmbeddedResourceSourceExtension Condition="'$(Language)' == 'C#'">cs</_EmbeddedResourceSourceExtension>
      <_EmbeddedResourceSourceExtension Condition="'$(Language)' == 'VB'">vb</_EmbeddedResourceSourceExtension>
    </PropertyGroup>

    <Error Text="GenerateResxSource doesn't support language: '$(Language)'" Condition="'$(_EmbeddedResourceSourceExtension)' == ''"/>
    <ItemGroup>
      <EmbeddedResourceSG Include="@(EmbeddedResource)" Condition="'%(EmbeddedResource.GenerateSource)' == 'true' and '%(EmbeddedResource.XlfLanguage)' == ''" />
      <EmbeddedResourceSG Update="@(EmbeddedResourceSG)">
        <SourceOutputPath>$(IntermediateOutputPath)%(EmbeddedResourceSG.ManifestResourceName).$(_EmbeddedResourceSourceExtension)</SourceOutputPath>
      </EmbeddedResourceSG>
    </ItemGroup>
  </Target>
</Project>
