From 2c9670d56a70dc78cad3f94cd815fc75638fd034 Mon Sep 17 00:00:00 2001
From: Viktor Hofer <viktor.hofer@microsoft.com>
Date: Tue, 4 Feb 2025 23:47:43 +0100
Subject: [PATCH] Create arch neutral packages when building inside the VMR
 (#10405)

Backport: https://github.com/dotnet/wpf/pull/10405

---
 packaging/Directory.Build.props | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/packaging/Directory.Build.props b/packaging/Directory.Build.props
index a1f50ce3d..15516fade 100644
--- a/packaging/Directory.Build.props
+++ b/packaging/Directory.Build.props
@@ -16,10 +16,11 @@
       Set $(IsPackable) = true, except when
           $(CreateArchNeutralPackage) == true && $(Platform) != x86
         The idea here is that for arch-neutral packages, only the x86 build phase will generate the nuget package
-        The platform/RID specific packages will be generated in their respective $(Platform) specific build phases
+        The platform/RID specific packages will be generated in their respective $(Platform) specific build phases.
+        Platform neutral packages should always get generated when building the product (DotNetBuild=true).
     -->
     <IsPackable>true</IsPackable>
-    <IsPackable Condition="('$(Platform)'!='AnyCPU' and '$(Platform)'!='Win32' and '$(Platform)'!='x86') and '$(CreateArchNeutralPackage)'=='true'">false</IsPackable>
+    <IsPackable Condition="('$(Platform)'!='AnyCPU' and '$(Platform)'!='Win32' and '$(Platform)'!='x86') and '$(CreateArchNeutralPackage)'=='true' and '$(DotNetBuild)' != 'true'">false</IsPackable>
   </PropertyGroup>
 
   <PropertyGroup>
