From d6d8add5aad503877ee4344bce77dfa0b054752a Mon Sep 17 00:00:00 2001
From: Viktor Hofer <viktor.hofer@microsoft.com>
Date: Tue, 5 Nov 2024 14:53:29 +0000
Subject: [PATCH] Update SDK and remove net10 workaround

Backport: https://github.com/dotnet/windowsdesktop/pull/4763

---
 Directory.Build.props                          |  2 +-
 Directory.Build.targets                        | 18 ------------------
 global.json                                    |  2 +-
 .../src/sfx/Directory.Build.targets            | 12 ++++++++++++
 4 files changed, 14 insertions(+), 20 deletions(-)

diff --git a/Directory.Build.props b/Directory.Build.props
index 09e49d41..daf75b2f 100644
--- a/Directory.Build.props
+++ b/Directory.Build.props
@@ -26,7 +26,7 @@
     <!-- Only upgrade NuGetAudit warnings to errors for official builds. -->
     <WarningsNotAsErrors Condition="'$(OfficialBuild)' != 'true'">$(WarningsNotAsErrors);NU1901;NU1902;NU1903;NU1904</WarningsNotAsErrors>
 
-    <!-- Temporary, reove when arcade NetCurrent to net10. This requires a net10 targeting SDK -->
+    <!-- Temporary, remove when arcade NetCurrent to net10. This requires a net10 targeting SDK. -->
     <NetCurrent>net10.0</NetCurrent>
   </PropertyGroup>
 
diff --git a/Directory.Build.targets b/Directory.Build.targets
index d816857c..7b2a3390 100644
--- a/Directory.Build.targets
+++ b/Directory.Build.targets
@@ -10,22 +10,4 @@
     <NETCoreAppMaximumVersion>$(MajorVersion).$(MinorVersion)</NETCoreAppMaximumVersion>
   </PropertyGroup>
 
-  <ItemGroup>
-    <!-- After the net10 SDK is available, this should change back to an Update without the TargetFramework property. -->
-    <KnownFrameworkReference
-      Include="@(KnownFrameworkReference->WithMetadataValue('TargetFramework', 'net9.0'))"
-      DefaultRuntimeFrameworkVersion="$(MicrosoftNETCoreAppRefVersion)"
-      LatestRuntimeFrameworkVersion="$(MicrosoftNETCoreAppRefVersion)"
-      TargetingPackVersion="$(MicrosoftNETCoreAppRefVersion)"
-      TargetFramework="net10.0" />
-    <KnownFrameworkReference Remove="Microsoft.AspNetCore.App" />
-    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App" />
-    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WindowsForms" />
-    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WPF" />
-
-    <KnownCrossgen2Pack Include="@(KnownCrossgen2Pack->WithMetadataValue('TargetFramework', 'net9.0'))"
-      Crossgen2PackVersion="$(MicrosoftNETCoreAppRefVersion)"
-      TargetFramework="net10.0" />
-  </ItemGroup>
-
 </Project>
diff --git a/global.json b/global.json
index 0e7f27a5..412fb4a9 100644
--- a/global.json
+++ b/global.json
@@ -1,6 +1,6 @@
 {
   "tools": {
-    "dotnet": "9.0.100-rc.2.24474.11",
+    "dotnet": "10.0.100-alpha.1.24551.9",
     "runtimes": {
       "dotnet": [
         "$(VSRedistCommonNetCoreSharedFrameworkx64100PackageVersion)"
diff --git a/src/windowsdesktop/src/sfx/Directory.Build.targets b/src/windowsdesktop/src/sfx/Directory.Build.targets
index 82de7dd9..ca14567b 100644
--- a/src/windowsdesktop/src/sfx/Directory.Build.targets
+++ b/src/windowsdesktop/src/sfx/Directory.Build.targets
@@ -2,6 +2,18 @@
 
   <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory).., Directory.Build.targets))\Directory.Build.targets" />
 
+  <ItemGroup>
+    <KnownFrameworkReference
+      Update="Microsoft.NETCore.App"
+      DefaultRuntimeFrameworkVersion="$(MicrosoftNETCoreAppRefVersion)"
+      LatestRuntimeFrameworkVersion="$(MicrosoftNETCoreAppRefVersion)"
+      TargetingPackVersion="$(MicrosoftNETCoreAppRefVersion)" />
+    <KnownFrameworkReference Remove="Microsoft.AspNetCore.App" />
+    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App" />
+    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WindowsForms" />
+    <KnownFrameworkReference Remove="Microsoft.WindowsDesktop.App.WPF" />
+  </ItemGroup>
+
   <ItemGroup>
     <PackageReference Include="Microsoft.DotNet.Build.Tasks.Archives" />
   </ItemGroup>
