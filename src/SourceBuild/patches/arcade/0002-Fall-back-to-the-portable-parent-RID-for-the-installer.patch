From caf86fe9338fb779512cd8295b15df8f7bc88d12 Mon Sep 17 00:00:00 2001
From: Jeremy Koritzinsky <jekoritz@microsoft.com>
Date: Mon, 11 Nov 2024 11:11:48 -0800
Subject: [PATCH] Fall-back to the portable parent RID for the installer RID
 for non-portable builds.

Backport: https://github.com/dotnet/arcade/pull/15237
---
 .../build/installer.targets                                     | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/Microsoft.DotNet.Build.Tasks.Installers/build/installer.targets b/src/Microsoft.DotNet.Build.Tasks.Installers/build/installer.targets
index 2bb8687ae9c..a48fcf4e3f6 100644
--- a/src/Microsoft.DotNet.Build.Tasks.Installers/build/installer.targets
+++ b/src/Microsoft.DotNet.Build.Tasks.Installers/build/installer.targets
@@ -149,6 +149,8 @@
   <PropertyGroup>
     <InstallerRuntimeIdentifiers Condition="'$(InstallerRuntimeIdentifiers)' == ''">$(RuntimeIdentifiers)</InstallerRuntimeIdentifiers>
     <InstallerRuntimeIdentifier Condition="'$(InstallerRuntimeIdentifier)' == ''">$(RuntimeIdentifier)</InstallerRuntimeIdentifier>
+    <!-- When building a non-portable build, BaseOS specifies a known (portable) RID that is a parent of the curent runtime identifier. -->
+    <InstallerRuntimeIdentifier Condition="'$(PortableBuild)' != 'true' and '$(BaseOS)' != '$(RuntimeIdentifier)'">$(BaseOS)</InstallerRuntimeIdentifier>
   </PropertyGroup>
   
   <Import Project="$(MSBuildThisFileDirectory)installer.singlerid.targets"
