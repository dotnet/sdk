From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: "Matt Mitchell (.NET)" <mmitche@microsoft.com>
Date: Fri, 24 Jan 2025 07:02:06 -0800
Subject: [PATCH] Explicitly set the restore config file when restoing the internal tools project

Backport PR: https://github.com/dotnet/arcade/pull/15447

---
 src/Microsoft.DotNet.Arcade.Sdk/tools/Tools.proj | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/Microsoft.DotNet.Arcade.Sdk/tools/Tools.proj b/src/Microsoft.DotNet.Arcade.Sdk/tools/Tools.proj
index ba7001e73..a42f18f11 100644
--- a/src/Microsoft.DotNet.Arcade.Sdk/tools/Tools.proj
+++ b/src/Microsoft.DotNet.Arcade.Sdk/tools/Tools.proj
@@ -87,9 +87,13 @@
   <!-- Set as DependsOnTargets when internal tools (e.g. IBC data, optprof) is required -->
   <Target Name="RestoreInternalTooling"
           AfterTargets="$(RestoreInternalToolingAfterTargets)">
-    <MSBuild Projects="$(RepoRoot)eng/common/internal/Tools.csproj"
+    <PropertyGroup>
+      <InternalToolsRestoreProject>$(RepoRoot)eng/common/internal/Tools.csproj</InternalToolsRestoreProject>
+      <InternalToolsRestoreConfig>$(RepoRoot)eng/common/internal/NuGet.config</InternalToolsRestoreConfig>
+    </PropertyGroup>
+    <MSBuild Projects="$(InternalToolsRestoreProject)"
         Targets="Restore"
-        Properties="@(_RestoreToolsProps);_NETCORE_ENGINEERING_TELEMETRY=Restore"
+        Properties="@(_RestoreToolsProps);RestoreConfigFile=$(InternalToolsRestoreConfig);_NETCORE_ENGINEERING_TELEMETRY=Restore"
         Condition="'$(Restore)' == 'true'"/>
   </Target>
 
