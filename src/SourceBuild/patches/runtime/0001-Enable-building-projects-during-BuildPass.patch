From ce566bbc998ae3140a21e360b3e09a3f4ff5084b Mon Sep 17 00:00:00 2001
From: Jeremy Koritzinsky <jekoritz@microsoft.com>
Date: Wed, 5 Feb 2025 11:35:24 -0800
Subject: [PATCH] Enable building projects during BuildPass=2 in dotnet/runtime

Backport: https://github.com/dotnet/runtime/pull/112201
---
 eng/Build.props | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/eng/Build.props b/eng/Build.props
index b2d72fb52aaea7..01705fc98d4f17 100644
--- a/eng/Build.props
+++ b/eng/Build.props
@@ -5,5 +5,7 @@
   </PropertyGroup>
   <ItemGroup>
     <ProjectToBuild Include="$(RepoRoot)Build.proj" />
+    <!-- dotnet/runtime controls which projects run in which passes through our DefaultSubsets settings in eng/Subsets.props -->
+    <ProjectToBuild Include="$(RepoRoot)Build.proj" BuildPass="2" />
   </ItemGroup>
 </Project>
diff --git a/eng/Build.props b/eng/Build.props
index 01705fc98d4..45d7d76c82a 100644
--- a/eng/Build.props
+++ b/eng/Build.props
@@ -6,6 +6,6 @@
   <ItemGroup>
     <ProjectToBuild Include="$(RepoRoot)Build.proj" />
     <!-- dotnet/runtime controls which projects run in which passes through our DefaultSubsets settings in eng/Subsets.props -->
-    <ProjectToBuild Include="$(RepoRoot)Build.proj" BuildPass="2" />
+    <ProjectToBuild Include="$(RepoRoot)Build.proj" DotNetBuildPass="2" Condition="'$(DotNetBuildPass)' == '2'" />
   </ItemGroup>
 </Project>
diff --git a/eng/Subsets.props b/eng/Subsets.props
index efb52377533..1a32d113896 100644
--- a/eng/Subsets.props
+++ b/eng/Subsets.props
@@ -69,7 +69,7 @@
     <DefaultSubsets Condition="'$(DotNetBuildMonoCrossAOT)' == 'true'">mono+packs</DefaultSubsets>
 
     <!-- In the Win-x86 BuildPass2 job in the VMR, we want to build the cross-OS DACs and pack them. -->
-    <DefaultSubsets Condition="'$(DotNetBuildPass)' == '2' and '$(TargetRid)' == 'win-x86'">crossdacpack</DefaultSubsets>
+    <DefaultSubsets Condition="'$(DotNetBuildPass)' == '2' and '$(TargetOS)' == 'windows' and '$(TargetArchitecture)' == 'x86'">crossdacpack</DefaultSubsets>
   </PropertyGroup>
 
   <PropertyGroup>
